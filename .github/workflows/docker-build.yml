# name: üèóÔ∏è Build & Push Docker Image

# on:
#   push:
#     branches: [ "main", "staging" ]

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout Code
#         uses: actions/checkout@v4

#       - name: Login to GHCR
#         run: |
#           echo "${{ secrets.GHCR_PAT }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin

#       - name: Build & Push Image
#         run: |
#           IMAGE_NAME=ghcr.io/jhsassociatesllp/jhs-timesnap

#           # Map branch ‚Üí correct tag
#           if [ "${GITHUB_REF_NAME}" = "main" ]; then
#             TAG="production"
#           else
#             TAG="staging"
#           fi

#           echo "üì¶ Building image: $IMAGE_NAME:$TAG"
#           docker build -t $IMAGE_NAME:$TAG .

#           echo "üì§ Pushing image: $IMAGE_NAME:$TAG"
#           docker push $IMAGE_NAME:$TAG


name: üèóÔ∏è Build & Push Docker Image

on:
  push:
    branches:
      - main
      - staging

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Login to GitHub Container Registry
        run: |
          echo "${{ secrets.GHCR_PAT }}" | docker login ghcr.io -u "${{ github.actor }}" --password-stdin

      - name: Build & Push Docker Image
        run: |
          IMAGE="ghcr.io/jhsassociatesllp/jhs-timesnap"

          if [ "${GITHUB_REF_NAME}" = "main" ]; then
            TAG="production"
          elif [ "${GITHUB_REF_NAME}" = "staging" ]; then
            TAG="staging"
          else
            echo "‚ùå Unsupported branch: ${GITHUB_REF_NAME}"
            exit 1
          fi

          echo "üì¶ Building $IMAGE:$TAG"
          docker build -t "$IMAGE:$TAG" .

          echo "üì§ Pushing $IMAGE:$TAG"
          docker push "$IMAGE:$TAG"
